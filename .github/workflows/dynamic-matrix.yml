name: Scan Maven project
on:
  workflow_dispatch:
    inputs:
      repository:
        description: 'GitHub repository for the Maven project to be scanned.'
        required: true
        type: string
jobs:
  generate-matrix:
    runs-on: self-hosted
    steps:
      - name: Checkout Pomelo
        uses: actions/checkout@v3
        with:
          path: pomelo
      - name: Checkout project
        uses: actions/checkout@v3
        with:
          repository: ${{ github.event.inputs.repository }}
          path: project
      - name: List modules
        id: list-modules
        uses: ./pomelo/.github/actions/list-modules
        working-directory: ./project
      - name: Print modules
        run: echo ${{ steps.list-modules.outputs.modules }}
    outputs:
      modules: ${{ steps.list-modules.outputs.modules }}
  scan-modules:
    runs-on: self-hosted
    needs: generate-matrix
    strategy:
      matrix:
        module: ${{ fromJSON(needs.generate-matrix.outputs.modules) }}
    steps:
      - name: Print ${{ matrix.module }}
        run: |
          echo ${{ matrix.module }}
        shell: bash